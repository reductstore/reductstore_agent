#!/usr/bin/env bash
set -euo pipefail

if [ -t 2 ]; then
  GREEN='\033[0;32m'; YELLOW='\033[1;33m'; RED='\033[0;31m'; NC='\033[0m'
else
  GREEN=''; YELLOW=''; RED=''; NC=''
fi
info()  { printf "%bINFO%b  %s\n"  "$GREEN" "$NC" "$*" >&2; }
warn()  { printf "%bWARN%b  %s\n"  "$YELLOW" "$NC" "$*" >&2; }
err()   { printf "%bERROR%b %s\n" "$RED" "$NC" "$*" >&2; }

CONFIG_FILE="$SNAP_COMMON/configuration/params.yml"

info "configuration-read plug connected"
if [ -f "$CONFIG_FILE" ]; then
  info "COS config found: $CONFIG_FILE"
else
  warn "COS config not found at: $CONFIG_FILE (plug connected, file missing)"
fi

SERVICE="${SNAP_INSTANCE_NAME:-$SNAP_NAME}.recorder"
info "Restarting service: $SERVICE"
if ! snapctl restart "$SERVICE"; then
  warn "restart failed (service may be disabled); trying start"
  snapctl start "$SERVICE" || warn "unable to start service $SERVICE"
fi
